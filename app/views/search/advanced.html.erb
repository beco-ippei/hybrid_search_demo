<div class="search-container two-column-layout">
  <!-- 左カラム: 詳細検索フォームと検索結果 -->
  <div class="left-column">
    <div class="search-header">
      <h1>🔎 詳細検索</h1>
      <p class="subtitle">条件を指定して求人を検索できます</p>
      <div class="search-mode-toggle">
        <%= link_to "← AI検索に切り替え", search_path, class: "mode-link" %>
      </div>
    </div>

    <!-- 詳細検索フォーム -->
    <div class="search-form-wrapper">
      <%= form_with url: advanced_search_path, method: :get, class: "advanced-search-form", data: { turbo_frame: "search_results" } do |f| %>

        <!-- マッチング用キーワード -->
        <div class="form-group">
          <label class="form-label">
            <span class="label-icon">🎯</span>
            <span class="label-text">マッチング用キーワード</span>
            <span class="label-hint">（意味検索に使用されます。職種や技術スキルなど）</span>
          </label>
          <%= f.text_field :keyword,
            value: params[:keyword],
            placeholder: '例: Ruby on Rails サーバーサイド開発',
            class: "form-input" %>
        </div>

        <!-- 職種カテゴリ -->
        <div class="form-group">
          <label class="form-label">
            <span class="label-icon">💼</span>
            <span class="label-text">職種カテゴリ</span>
          </label>
          <div class="checkbox-grid">
            <% @job_categories.each do |category| %>
              <label class="checkbox-label">
                <%= f.radio_button :job_category, category,
                  checked: params[:job_category] == category,
                  class: "checkbox-input" %>
                <span class="checkbox-text"><%= category %></span>
              </label>
            <% end %>
          </div>
        </div>

        <!-- 事業種別 -->
        <div class="form-group">
          <label class="form-label">
            <span class="label-icon">🏢</span>
            <span class="label-text">事業種別</span>
          </label>
          <div class="checkbox-grid">
            <% @business_types.each do |business_type| %>
              <label class="checkbox-label">
                <%= f.radio_button :business_type, business_type,
                  checked: params[:business_type] == business_type,
                  class: "checkbox-input" %>
                <span class="checkbox-text"><%= business_type %></span>
              </label>
            <% end %>
          </div>
        </div>

        <!-- 勤務地 -->
        <div class="form-group">
          <label class="form-label">
            <span class="label-icon">📍</span>
            <span class="label-text">勤務地</span>
          </label>
          <div class="checkbox-grid">
            <% @locations.each do |location| %>
              <label class="checkbox-label">
                <%= f.radio_button :location, location,
                  checked: params[:location] == location,
                  class: "checkbox-input" %>
                <span class="checkbox-text"><%= location %></span>
              </label>
            <% end %>
          </div>
        </div>

        <!-- 最低年収 -->
        <div class="form-group">
          <label class="form-label">
            <span class="label-icon">💰</span>
            <span class="label-text">最低年収（万円以上）</span>
          </label>
          <%= f.number_field :min_salary,
            value: params[:min_salary],
            placeholder: '例: 500',
            min: 0,
            step: 50,
            class: "form-input" %>
        </div>

        <div class="form-actions">
          <%= f.submit "検索", class: "search-button" %>
          <%= link_to "クリア", advanced_search_path, class: "clear-button" %>
        </div>
      <% end %>
    </div>

    <!-- 検索結果エリア -->
    <%= turbo_frame_tag "search_results" do %>
      <% if @search_performed %>
        <div class="search-results">
          <% if @error_message %>
            <div class="error-message">
              ⚠️ <%= @error_message %>
            </div>
          <% else %>
            <!-- 検索結果 -->
            <div class="results-header">
              <h2>検索結果</h2>
              <span class="results-count"><%= @jobs.size %>件</span>
            </div>

            <% if @jobs.any? %>
              <div class="job-list">
                <% @jobs.each do |job| %>
                  <div class="job-card">
                    <div class="job-header">
                      <h3 class="job-title"><%= job.title %></h3>
                      <span class="job-salary">💰 <%= job.min_salary %>万円〜</span>
                    </div>

                    <div class="job-meta">
                      <span class="job-badge category"><%= job.job_category %></span>
                      <span class="job-badge business"><%= job.business_type %></span>
                      <span class="job-badge location">📍 <%= job.location %></span>
                    </div>

                    <p class="job-description"><%= truncate(job.description, length: 100) %></p>

                    <div class="job-footer">
                      <% if job.neighbor_distance %>
                        <span class="similarity-score" title="AIによる類似度スコア（0に近いほど関連性が高い）">
                          🎯 類似度: <%= number_to_percentage((1 - job.neighbor_distance) * 100, precision: 1) %>
                        </span>
                      <% end %>
                    </div>
                  </div>
                <% end %>
              </div>
            <% else %>
              <div class="no-results">
                <p>😔 該当する求人が見つかりませんでした</p>
                <p class="no-results-hint">
                  検索条件を変えてみてください。
                </p>
              </div>
            <% end %>
          <% end %>
        </div>
      <% end %>
    <% end %>
  </div>

  <!-- 右カラム: 全件データ -->
  <div class="right-column">
    <div class="all-jobs-header">
      <h2>📋 全求人データ</h2>
      <span class="all-jobs-count"><%= @all_jobs.size %>件</span>
    </div>

    <div class="all-jobs-list">
      <% @all_jobs.each do |job| %>
        <div class="job-card compact">
          <div class="job-header">
            <h4 class="job-title"><%= job.title %></h4>
            <span class="job-salary-compact">💰 <%= job.min_salary %>万</span>
          </div>

          <div class="job-meta">
            <span class="job-badge category"><%= job.job_category %></span>
            <span class="job-badge business"><%= job.business_type %></span>
          </div>

          <div class="job-meta">
            <span class="job-badge location">📍 <%= job.location %></span>
          </div>

          <p class="job-description-compact"><%= truncate(job.description, length: 80) %></p>
        </div>
      <% end %>
    </div>
  </div>
</div>
